# csv-stats-viewer - プロジェクト設定

## プロジェクト概要

Next.js、React、TypeScriptで構築されたCSVを読み込んで統計情報を表示するプロジェクトです。

## 技術スタック

- **フレームワーク**: Next.js 15.5.6
- **UIライブラリ**: React 19.2.0
- **言語**: TypeScript 5.9.3
- **スタイリング**: Tailwind CSS 4.1.15
- **パッケージマネージャー**: npm

## プロジェクト構成

```
csv-stats-viewer/
├── app/              # Next.js App Router
├── .claude/          # Claude Code設定
├── next.config.ts    # Next.js設定
├── tailwind.config.ts # Tailwind CSS設定
├── tsconfig.json     # TypeScript設定
└── package.json      # プロジェクト依存関係
```

## 開発ガイドライン

### コードスタイル

- すべてのコンポーネントとユーティリティにTypeScriptを使用
- Next.js App Routerの規約に従う
- スタイリングにはTailwind CSSを使用（ユーティリティファーストアプローチ）
- React hooksを使った関数コンポーネントを優先
- TypeScript strict modeを使用
- **1ファイル500行以内に収めること**
  - 500行を超える場合は積極的にコンポーネント分割を検討
  - 関連する機能ごとに小さなコンポーネントに分割
  - 再利用可能な部分は独立したコンポーネントとして抽出

### 可読性とコードの分割

- **早期returnを推奨**
  - 条件が満たされない場合やエラーの場合は、早期にreturnしてネストを避ける
  - ガード節を使って正常系のロジックを浅い階層に保つ
  - 可読性を向上し、バグを見つけやすくする

- **説明変数・要約変数を活用する**
  - 複雑な式や条件判定は、意図を表す変数名で分割する
  - 同じプロパティチェーンを繰り返し参照する場合は変数に抽出する
  - 変数名で式の意味や条件の意図を明確にすることで、可読性が向上する

- **巨大な式は分割する**
  - ネストが深い式や長い条件判定は小さく分割する
  - 分割代入を活用して冗長なプロパティアクセスを減らす
  - タイプミスの防止とデバッグの容易化につながる

### ファイル命名規則

- コンポーネント: PascalCase（例：`UserProfile.tsx`）
- ユーティリティ: camelCase（例：`formatDate.ts`）
- ページ: ハイフン区切りの小文字（例：`user-profile/page.tsx`）
- 型定義: PascalCaseで`.types.ts`サフィックス

### コンポーネント構造

```typescript
// 推奨されるコンポーネント構造
interface ComponentProps {
  // Props定義
}

export default function Component({ ...props }: ComponentProps) {
  // コンポーネントロジック
  return (
    // JSX
  )
}
```

## コマンド

### 開発
```bash
npm run dev        # 開発サーバー起動（ポート3000）
npm run build      # 本番用ビルド
npm run start      # 本番サーバー起動
npm run lint       # ESLint実行
```

### 品質チェック

コミット前に：
1. `npm run lint`を実行してリントエラーをチェック
2. TypeScriptコンパイルが通ることを確認
3. 開発モードでコンポーネントをテスト

## Claude Code設定

### 機能実装時の方針

1. **コンポーネント作成**: 適切な型定義を含むTypeScriptを使用
2. **スタイリング**: カスタムCSSよりもTailwindユーティリティクラスを優先
3. **状態管理**: React hooks（useState、useEffectなど）を使用
4. **APIルート**: Next.jsの規約に従い`app/api/`ディレクトリに配置
5. **サーバーコンポーネント**: クライアント側のインタラクティビティが必要でない限りデフォルトで使用

### コード生成パターン

- 常に適切なTypeScript型を含める
- モダンなReactパターンを使用（クラスコンポーネントは使用しない）
- Next.js 15 App Routerのベストプラクティスに従う
- Tailwindブレークポイントでレスポンシブデザインを実装
- 適切なエラーハンドリングを追加

### テストアプローチ

- **E2Eテスト**: Playwrightを使用して実装
- **テストフレームワーク**: Playwright Test
- TypeScriptによる型安全性を優先
- 開発環境での手動テスト
- エッジケースとエラー状態を考慮

### Playwrightテスト指針

- すべてのE2Eテストは`tests/`ディレクトリに配置
- テストファイル命名規則: `*.spec.ts`
- ユーザーフローをベースにテストシナリオを作成
- クリティカルパス（認証、サブスクリプション、チャット機能）を優先的にカバー
- テストは独立して実行可能であること（他のテストに依存しない）

## Next.js 15固有の注意事項

- デフォルトでサーバーコンポーネントを使用
- 必要な場合のみ`'use client'`ディレクティブを使用
- App Routerの機能（layouts、loading、error states）を活用
- React 19のベストプラクティスに従う


## GitHub運用ルール

### PR作成時のテンプレート

```markdown

## 概要
この機能/修正の目的を簡潔に説明

## 変更内容
- 変更点1
- 変更点2

## テスト方法
1. 手順1
2. 手順2
3. 期待される結果

## チェックリスト
- [ ] コードが適切に型定義されている
- [ ] `npm run lint` でエラーがない
- [ ] TypeScriptコンパイルが通る
- [ ] ローカル環境でテスト済み
```

### Claude Codeでの実装時の注意

- **作業開始時は必ずブランチを作成すること**
  - ブランチ名: `feature/[機能名]` または `fix/[バグ名]`
  - 例: `feature/scenario-selection`, `fix/evaluation-bug`
  - mainブランチで直接作業しない
- **実装タスクが完了したら、必ず[docs/impl/base_implement.md](../docs/impl/base_implement.md)の該当タスクにチェックマークを入れること**
  - 例：`- [ ]` → `- [x]`
  - 複数の関連タスクがある場合は、すべて完了時点でチェック
  - チェック更新は実装完了と同じコミットまたは直後に実施


## 知見蓄積のサイクル

### 知見の記録と提案

ユーザーとのやり取りを通して、以下のような場面では必ず回答の最後に知見をまとめ、ルール更新の提案をすること：

- **再利用可能な問題解決パターン**：他の場面でも発生しうる問題を解決した場合
- **効率化のノウハウ**：開発フローや実装パターンの効率化を発見した場合
- **プロジェクト固有の設計判断**：アーキテクチャや技術選定に関する重要な判断をした場合
- **ベストプラクティスの発見**：Next.js、TypeScript、Tailwindなどの使い方で有用なパターンを見つけた場合

### CLAUDE.mdの更新

知見が蓄積された場合、以下のいずれかの方法でCLAUDE.mdを更新すること：

1. **既存セクションへの追記**
   - 該当するセクション（開発ガイドライン、Claude Code設定など）に追記
   - 具体的な例やコード例を含める

2. **新規セクションの作成**
   - 既存のどのセクションにも当てはまらない重要な知見の場合
   - 明確な見出しと目的を記載

3. **更新提案の形式**
   ```markdown
   ### 💡 知見まとめ

   **問題**: [発生した問題]
   **解決策**: [適用した解決策]
   **適用範囲**: [この知見が役立つ場面]
   **CLAUDE.md更新提案**: [具体的な追記内容]
   ```

## プロジェクトルール参照
### 実装計画ドキュメント
- **[docs/overview.md](../docs/overview.md)**
  - サービス全体の概要と体験フロー